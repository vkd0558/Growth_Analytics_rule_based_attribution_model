version: 2

models:
  - name: sessions
    tests:
      - unique_user_ids:
          severity: warn
          description: "Check if user_id values in sessions table are unique"
          query: |
            SELECT user_id, COUNT(*) as count
            FROM {{ ref('sessions') }}
            GROUP BY user_id
            HAVING COUNT(*) > 1
      - count_records: test_sessions_record_count
        description: "Check the total number of records in sessions table"
        severity: warning
        query: >
          SELECT COUNT(*) as count
          FROM {{ ref('sessions') }}
        expect:
          - row_count: 1
            count: 1000
            success: true
            message: "Total number of records in sessions table is 1000"
      - not_null:
          column: user_id
          description: "Check if 'user_id' column has NULL values in sessions table"
          severity: error
          query: >
            SELECT COUNT(*) as count
            FROM {{ ref('sessions') }}
            WHERE user_id IS NULL
          expect:
            - row_count: 1
              count: 0
              success: true
              message: "No NULL values found in 'user_id' column of sessions table"
  - name: conversions
    tests:
      - null_user_ids:
          severity: error
          description: "Check if user_id values in conversions table are not null"
          query: |
            SELECT *
            FROM {{ ref('conversions') }}
            WHERE user_id IS NULL
      - count_records: test_conversions_record_count
        description: "Check the total number of records in conversions table"
        severity: warning
        query: >
          SELECT COUNT(*) as count
          FROM {{ ref('conversions') }}
        expect:
          - row_count: 1
            count: 500
            success: true
            message: "Total number of records in conversions table is 500"
      - not_null:
          column: user_id
          description: "Check if 'user_id' column has NULL values in conversions table"
          severity: error
          query: >
            SELECT COUNT(*) as count
            FROM {{ ref('conversions') }}
            WHERE user_id IS NULL
          expect:
            - row_count: 1
              count: 0
              success: true
              message: "No NULL values found in 'user_id' column of conversions table"

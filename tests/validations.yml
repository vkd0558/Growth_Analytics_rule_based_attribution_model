version: 2

models:
  - name: sessions
    tests:
      - unique_user_ids:
          severity: warn
          description: "Check if user_id values in sessions table are unique"
          query: |
            SELECT user_id, COUNT(*) as count
            FROM {{ ref('sessions') }}
            GROUP BY user_id
            HAVING COUNT(*) > 1
      - count_records: test_sessions_record_count
        description: "Check the total number of records in sessions table"
        severity: warning
        query: >
          SELECT COUNT(*) as count
          FROM {{ ref('sessions') }}
        expect:
          - row_count: 1
            count: 1000
            success: true
            message: "Total number of records in sessions table is 1000"
  - name: conversions
    tests:
      - null_user_ids:
          severity: error
          description: "Check if user_id values in conversions table are not null"
          query: |
            SELECT *
            FROM {{ ref('conversions') }}
            WHERE user_id IS NULL
      - count_records: test_conversions_record_count
        description: "Check the total number of records in conversions table"
        severity: warning
        query: >
          SELECT COUNT(*) as count
          FROM {{ ref('conversions') }}
        expect:
          - row_count: 1
            count: 500
            success: true
            message: "Total number of records in conversions table is 500"
